{% extends "group_page.html" %}

{% block title %}ì±„íŒ…{% endblock %}

{% block group_content %}


<h2>ðŸ’¬ ì‹¤ì‹œê°„ ì±„íŒ…</h2>
<div id="chat-box" style="border:1px solid #ccc; height:300px; overflow-y:scroll; padding:10px; background:#fff; margin-bottom:10px;"></div>
<form id="chat-form" onsubmit="sendMessage(event)">
    <input type="text" id="chat-input" placeholder="ë©”ì‹œì§€ ìž…ë ¥..." style="width:80%; padding:8px;" required>
    <button type="submit" style="padding:8px 12px;">ì „ì†¡</button>
</form>


</body>
<script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
<script>
    let currentUsername = "{{ session['username'] }}"; // ì‹¤ì œ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìž ì´ë¦„ìœ¼ë¡œ ëŒ€ì²´ ê°€ëŠ¥
    const socket = io();
    
    async function handleSubmit(event) {
        event.preventDefault();
        const date = document.getElementById('quiz-date').value;
        const desc = document.getElementById('quiz-desc').value;
        const answer = document.getElementById('quiz-answer').value;
        const score = parseInt(document.getElementById('quiz-score').value);

        await fetch('/add_quiz', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                date,
                desc,
                answer,
                score,
                username: currentUsername  // âœ… ì‚¬ìš©ìž ì´ë¦„ ì „ë‹¬
            })
        });

    fetchQuizzes();
    }

 // ðŸŸ¢ ì‹¤ì‹œê°„ ì±„íŒ… ê´€ë ¨ í•¨ìˆ˜
    function sendMessage(event) {
        event.preventDefault();
        const input = document.getElementById('chat-input');
        const message = input.value.trim();
        if (message !== "") {
            socket.emit('chat_message', { username: currentUsername, message });
            input.value = "";
        }
    }

    socket.on('chat_message', (data) => {
        const chatBox = document.getElementById('chat-box');
        if (chatBox) {
            const msgDiv = document.createElement('div');
            msgDiv.innerHTML = `<strong>${data.username}</strong>: ${data.message}`;
            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    });
</script>
</html>
{% endblock %}