{% extends "base.html" %}

{% block title %}ëŒ€ì‹œë³´ë“œ{% endblock %}

{% block content %}
<div style="display: flex; height: 100vh;">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        body {
            height: 100vh;
            background-color: #ebffe5;
        }
        a:link {
            text-decoration: none;
        }
        .sidebar {
            width: 250px;
            background: #ebffe5;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        }
        .sidebar h2 {
            margin-bottom: 15px;
            font-size: 20px;
        }
        .sidebar button {
            padding: 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 5px;
            background: #00ff5e;
            color: #000;
        }
        .sidebar button:hover {
            background-color: #00be00;
        }
        .sidebar ul {
            list-style: none;
        }
        .sidebar ul li {
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 5px;
        }
        .sidebar ul li:hover {
            background: #c9f9b0;
        }
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .topbar {
            background: #ebffe5;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .search-box input {
            padding: 8px;
            width: 400px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f0ffeb;
        }
        .buttons button {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 5px;
            background: #00ff5e;
            color: #000;
        }
        .buttons button:hover {
            background: #00be00;
        }
        .content {
            flex: 1;
            padding: 20px;
        }
        @media (width >= 500px) {
            .buttons {
                width: 300px;
            }
        }
    </style>
    <div class="sidebar">
        <h2>ë©”ë‰´</h2>
        <ul>
            <li onclick="showContent('todo')">âœ… í•´ì•¼ í•  ì¼</li>
            <li onclick="showContent('notice')">ğŸ“¢ ê³µì§€</li>
            <li onclick="showContent('chat')">ğŸ’¬ ì±„íŒ…</li>
            <li onclick="showContent('share')">ğŸ“ ìë£Œ ê³µìœ </li>
            <li onclick="showContent('quiz')">ğŸ“– ë¬¸ì œí’€ì´</li>
            <li onclick="showContent('calendar')">ğŸ“† ì¼ì •</li>
            <button onclick="location.href='/'">ğŸ–¥ï¸ ìŠ¤í„°ë”” ì‹œì‘</button>
        </ul>
    </div>

    <div class="main" style="flex: 1; display: flex; flex-direction: column;">
        <div id="content" class="content" style="flex: 1; padding: 20px;">
            <h1>ëŒ€ì‹œë³´ë“œ</h1>
            <p>ì—¬ê¸°ì— ì»¨í…ì¸ ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.</p>
        </div>
    </div>
</div>
<!-- Socket.IOë¥¼ í†µí•œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ -->
<script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
<script>
    let currentUsername = "{{ session['username'] }}"; // ì‹¤ì œ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ëŒ€ì²´ ê°€ëŠ¥
    const socket = io();
function showContent(type) {
    const content = document.getElementById('content');
    

    if (type === 'quiz') {
        content.innerHTML = `
            <h2>ğŸ“– ë¬¸ì œí’€ì´</h2>
            <form onsubmit="handleSubmit(event)">
                <label>ë‚ ì§œ: <input type="text" id="quiz-date" required></label><br><br>
                <label>ë¬¸ì œ ì„¤ëª…:<br>
                    <textarea id="quiz-desc" rows="4" cols="40" required></textarea>
                </label><br><br>
                <label>ì •ë‹µ: <input type="text" id="quiz-answer" required></label><br><br>
                <label>ì ìˆ˜: <input type="number" id="quiz-score" required></label><br><br>
                <button type="submit">ì¶”ê°€í•˜ê¸°</button>
            </form>
            <hr>
            <div id="score-info">
                <p>ë§ì¶˜ ë¬¸ì œ ìˆ˜: <span id="solved-count">0</span></p>
                <p>ì´ ì ìˆ˜: <span id="total-score">0</span></p>
            </div>
            <hr>
            <div id="quiz-list">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        `;
        fetchQuizzes();
        updateScore(currentUsername);
    } else if (type === 'chat') {
            content.innerHTML = `
                <h2>ğŸ’¬ ì‹¤ì‹œê°„ ì±„íŒ…</h2>
                <div id="chat-box" style="border:1px solid #ccc; height:300px; overflow-y:scroll; padding:10px; background:#fff; margin-bottom:10px;"></div>
                <form id="chat-form" onsubmit="sendMessage(event)">
                    <input type="text" id="chat-input" placeholder="ë©”ì‹œì§€ ì…ë ¥..." style="width:80%; padding:8px;" required>
                    <button type="submit" style="padding:8px 12px;">ì „ì†¡</button>
                </form>
            `;
        } else {
            content.innerHTML = `<h2>${type} í˜ì´ì§€</h2><p>ì½˜í…ì¸ ë¥¼ ì—¬ê¸°ì— ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>`;
        }
}

async function handleSubmit(event) {
    event.preventDefault();
    const date = document.getElementById('quiz-date').value;
    const desc = document.getElementById('quiz-desc').value;
    const answer = document.getElementById('quiz-answer').value;
    const score = parseInt(document.getElementById('quiz-score').value);

    await fetch('/add_quiz', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            date,
            desc,
            answer,
            score,
            username: currentUsername  // âœ… ì‚¬ìš©ì ì´ë¦„ ì „ë‹¬
        })
    });

    fetchQuizzes();
}

 // ğŸŸ¢ ì‹¤ì‹œê°„ ì±„íŒ… ê´€ë ¨ í•¨ìˆ˜
 function sendMessage(event) {
        event.preventDefault();
        const input = document.getElementById('chat-input');
        const message = input.value.trim();
        if (message !== "") {
            socket.emit('chat_message', { username: currentUsername, message });
            input.value = "";
        }
    }

    socket.on('chat_message', (data) => {
        const chatBox = document.getElementById('chat-box');
        if (chatBox) {
            const msgDiv = document.createElement('div');
            msgDiv.innerHTML = `<strong>${data.username}</strong>: ${data.message}`;
            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    });
    

</script>


</body>
</html>
{% endblock %}