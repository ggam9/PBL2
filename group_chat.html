{% extends "group_page.html" %}

{% block title %}ì±„íŒ…{% endblock %}

{% block group_content %}

<h2>ğŸ’¬ ì±„íŒ…ë°©</h2>

<!-- Socket.IO ë° JS ì—°ê²° -->
<script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
<script>
    const postId = {{ post.id }};
    const currentUsername = "{{ session['username'] }}";
</script>
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>

<div id="chat-container">

    <!-- ğŸ”¹ ìƒë‹¨: ì°¸ì—¬ì ëª©ë¡ + 1:1 ì±„íŒ… -->
    <div style="display: flex; height: 300px; margin-bottom: 20px;">
        
        <!-- ì°¸ì—¬ì ëª©ë¡ -->
 <div id="participant-list" style="width: 30%; border: 1px solid #ccc; overflow-y: auto; padding: 10px;">
    <h4>ì°¸ì—¬ì</h4>
    <ul id="userList">
        {% for user in participants %}
            {% if user.username != session['username'] %}
                <li onclick="openPrivateChat('{{ user.username }}')" style="cursor: pointer;">
                    {{ user.username }}
                </li>
            {% endif %}
        {% endfor %}
    </ul>
 </div>

 <!-- 1:1 ì±„íŒ…ì°½ (ì²˜ìŒì—” ìˆ¨ê¹€) -->
 <div id="private-chat-panel" style="width: 70%; padding-left: 10px; display: none;">
    <div style="display: flex; justify-content: space-between;">
        <h4 id="private-chat-title">1:1 ì±„íŒ…</h4>
        <button onclick="closePrivateChat()">âŒ ë‹«ê¸°</button>
    </div>
    <div id="privateChatBox"
        style="height: 200px; overflow-y: scroll; border: 1px solid #aaa; padding: 10px; margin-bottom: 10px;">
    </div>
    <div>
        <input id="privateMsg" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 70%;">
        <button onclick="sendPrivateMessage()">ë³´ë‚´ê¸°</button>
    </div>
  </div>
 </div>

    <!-- ğŸ”¹ í•˜ë‹¨: ê·¸ë£¹ ì±„íŒ… -->
    <div>
        <h3>ê·¸ë£¹ ì±„íŒ…ë°©</h3>
        <div id="groupChatBox" 
             style="height: 250px; overflow-y: scroll; border: 1px solid #aaa; padding: 10px; margin-bottom: 10px;">
        </div>
        <div>
            <input id="groupMsg" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 70%;">
            <button onclick="sendGroupMessage()">ë³´ë‚´ê¸°</button>
        </div>
    </div>
</div>
    

<script>
    
    
    async function handleSubmit(event) {
        event.preventDefault();
        const date = document.getElementById('quiz-date').value;
        const desc = document.getElementById('quiz-desc').value;
        const answer = document.getElementById('quiz-answer').value;
        const score = parseInt(document.getElementById('quiz-score').value);

        await fetch('/add_quiz', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                date,
                desc,
                answer,
                score,
                username: currentUsername  // âœ… ì‚¬ìš©ì ì´ë¦„ ì „ë‹¬
            })
        });

    fetchQuizzes();
    }

</script>

{% endblock %}